<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å…¬å¼è½¬ Word</title>
    <script>
        window.MathJax = {
            tex: { 
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            startup: { typeset: false } 
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root { --primary: #007bff; --bg: #f4f6f9; --card: #ffffff; --text: #333; }
        body { 
            font-family: -apple-system, "Microsoft YaHei", sans-serif; 
            background: var(--bg); color: var(--text); margin: 0; padding: 20px; 
            height: 100vh; box-sizing: border-box; display: flex; flex-direction: column;
            position: relative;
        }
 
        .brand-logo {
            position: absolute;
            top: 20px; left: 25px;
            font-size: 24px; font-weight: 800; color: #2c3e50;
            letter-spacing: 2px; font-family: "KaiTi", "æ¥·ä½“", serif;
            z-index: 100; pointer-events: none;
        }
 
        h1 { text-align: center; margin: 0 0 20px 0; font-size: 20px; color: #2c3e50; }
        
        .container { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px; 
            flex-grow: 1; min-height: 0; width: 100%; max-width: 1600px; margin: 0 auto;
        }
        
        .section { 
            background: var(--card); border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
            display: flex; flex-direction: column; overflow: hidden; border: 1px solid #e1e4e8;
        }
        
        .header {
            padding: 10px 15px; background: #f8f9fa; border-bottom: 1px solid #e1e4e8;
            font-weight: bold; color: #555; font-size: 14px;
            display: flex; justify-content: space-between; align-items: center;
        }
 
        textarea { 
            flex-grow: 1; width: 100%; padding: 15px; border: none; 
            font-family: Consolas, "Courier New", monospace; font-size: 14px; 
            resize: none; outline: none; line-height: 1.5; color: #24292e;
        }
        
        /* å’’è¯­æç¤ºåŒº */
        .prompt-box {
            padding: 12px 15px;
            background: #eef2f7;
            border-top: 1px solid #dce4ec;
            font-size: 13px;
            color: #495057;
            line-height: 1.5;
        }
        .prompt-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 4px;
            display: flex; justify-content: space-between;
        }
        .code-snippet {
            background: #fff;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-family: Consolas, monospace;
            color: #d63384;
            margin-top: 5px;
            user-select: all;
            cursor: pointer;
            white-space: pre-wrap; 
        }
        .code-snippet:hover { background: #fffdf0; border-color: #f0ad4e; }
 
        .preview-box { 
            flex-grow: 1; padding: 20px; background: #fff; 
            overflow-y: auto; white-space: pre-wrap; word-break: break-word; font-size: 16px; line-height: 1.6;
            display: block; 
        }
        .preview-box h2 { font-size: 1.4em; border-bottom: 2px solid #eee; margin-top: 20px; padding-bottom: 5px; color: #333; }
        .preview-box h3 { font-size: 1.2em; margin-top: 15px; font-weight: bold; color: #444; }
        .preview-box ul { margin: 10px 0 10px 20px; padding: 0; }
        .preview-box li { margin-bottom: 5px; }
        .preview-box strong { color: #000; font-weight: bold; }
        .preview-box blockquote { border-left: 4px solid #ddd; padding-left: 10px; color: #666; margin: 10px 0; }
 
        .toolbar {
            padding: 15px; border-top: 1px solid #e1e4e8; background: #fff;
            display: flex; flex-direction: column; gap: 10px; align-items: center;
        }
        
        .btn { 
            color: white; border: none; padding: 12px 30px; 
            border-radius: 6px; font-size: 16px; cursor: pointer; font-weight: 600; 
            transition: all 0.2s; background: var(--primary); width: 100%; max-width: 300px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .btn:hover { background: #0056b3; transform: translateY(-1px); }
        
        .status { font-size: 13px; color: #666; height: 20px; margin-top: 5px;}
        #clipboard-helper { position: absolute; left: -9999px; top: 0; }
    </style>
</head>
<body>
 
    <div class="brand-logo">written by Ycs</div>
 
    <h1>AI å…¬å¼è½¬ Word</h1>
    
    <div class="container">
        <div class="section">
            <div class="header">
                1. ç²˜è´´å†…å®¹
                <span style="font-size:12px; font-weight:normal; color:#888">æ”¯æŒ DeepSeek/è±†åŒ…/ChatGPT</span>
            </div>
            <textarea id="inputArea" placeholder="ç›´æ¥ç²˜è´´ AI çš„å›å¤å†…å®¹..."></textarea>
            
            <div class="prompt-box">
                <div class="prompt-title">
                    <span>ğŸš€ æé—®ä¸‡èƒ½å’’è¯­ (ç‚¹å‡»å¤åˆ¶)ï¼š</span>
                </div>
                <div class="code-snippet" onclick="copyPrompt(this)" title="ç‚¹å‡»å¤åˆ¶">è¯·è¾“å‡º Markdown æ ¼å¼ã€‚æ‰€æœ‰æ•°å­¦å…¬å¼è¯·åŠ¡å¿…ä½¿ç”¨æ ‡å‡† LaTeX è¯­æ³•ï¼šè¡Œå†…å…¬å¼ç”¨ $...$ åŒ…è£¹ï¼Œç‹¬ç«‹å…¬å¼ç”¨ $$...$$ åŒ…è£¹ã€‚ä¸è¦ä½¿ç”¨ä»£ç å—ã€‚</div>
            </div>
        </div>
 
        <div class="section">
            <div class="header">2. å®æ—¶é¢„è§ˆ</div>
            <div id="preview" class="preview-box"></div>
            <div class="toolbar">
                <button class="btn" onclick="copyAllToWord()">å¤åˆ¶åˆ° Word</button>
                <div id="status" class="status">å‡†å¤‡å°±ç»ª</div>
            </div>
        </div>
    </div>
 
    <div id="clipboard-helper" contenteditable="true"></div>
 
    <script>
        // === åˆå§‹åŒ–ï¼šé»˜è®¤å¡«å……æ¬§æ‹‰å…¬å¼ ===
        window.addEventListener('load', () => {
            const eulerText = "$$ e^{ix} = \\cos x + i\\sin x $$";
            const inputArea = document.getElementById('inputArea');
            inputArea.value = eulerText;
            renderPreview(eulerText); 
        });
 
        document.getElementById('inputArea').addEventListener('input', function() {
            renderPreview(this.value);
        });
 
        function copyPrompt(element) {
            const text = element.innerText;
            navigator.clipboard.writeText(text).then(() => {
                const originalBg = element.style.backgroundColor;
                element.style.backgroundColor = "#d4edda"; 
                setTimeout(() => { element.style.backgroundColor = originalBg; }, 300);
                alert("å’’è¯­å·²å¤åˆ¶ï¼");
            });
        }
 
        // === æ ¸å¿ƒæ¸…æ´—å¼•æ“  ===
        function normalizeAIOutput(text) {
            text = text.replace(/```latex/gi, '').replace(/```math/gi, '').replace(/```/g, '');
            text = text.replace(/\\\(([\s\S]*?)\\\)/g, '$$$1$$');
            text = text.replace(/\\\[([\s\S]*?)\\\]/g, '$$$$$1$$$$');
            text = text.replace(/\[\s*([\s\S]*?)\s*\]/g, function(match, content) {
                if (content.length > 2 && (content.includes('=') || content.includes('\\') || content.includes('^') || content.includes('_'))) {
                    return '$$' + content + '$$';
                }
                return match;
            });
            text = text.replace(/\\_/g, '_');
            return text;
        }
 
        function renderPreview(text) {
            const preview = document.getElementById('preview');
            let processedText = normalizeAIOutput(text);
 
            let htmlContent = processedText
                .replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
                .replace(/^###\s+(.*$)/gim, '<h3>$1</h3>')
                .replace(/^##\s+(.*$)/gim, '<h2>$1</h2>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/^[\*\-]\s+(.*$)/gim, '<ul><li>$1</li></ul>')
                .replace(/<\/ul>\s*<ul>/g, '')
                .replace(/^\>\s+(.*$)/gim, '<blockquote>$1</blockquote>');
 
            if (text.length < 100 && !text.includes('\n')) {
                preview.style.display = 'flex';
                preview.style.justifyContent = 'center';
                preview.style.alignItems = 'center';
            } else {
                preview.style.display = 'block';
                preview.style.textAlign = 'left';
            }
 
            preview.innerHTML = htmlContent;
            MathJax.typesetPromise([preview]);
        }
 
        async function copyAllToWord() {
            const status = document.getElementById('status');
            let rawText = document.getElementById('inputArea').value;
            const helper = document.getElementById('clipboard-helper');
            
            status.innerText = "æ­£åœ¨è½¬æ¢...";
            rawText = normalizeAIOutput(rawText);
 
            try {
                const parts = splitUniversal(rawText);
                let htmlBuffer = "";
 
                for (let part of parts) {
                    if (part.type === 'text') {
                        let htmlText = part.content
                            .replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
                            .replace(/^##\s+(.*?)(\n|$)/gm, '<h2>$1</h2>')
                            .replace(/^###\s+(.*?)(\n|$)/gm, '<h3>$1</h3>')
                            .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')
                            .replace(/^[\*\-]\s+(.*?)(\n|$)/gm, '<li>$1</li>')
                            .replace(/^\>\s+(.*?)(\n|$)/gm, '<blockquote>$1</blockquote>')
                            .replace(/\n/g, "<br>");
                        htmlBuffer += htmlText;
                    } else {
                        let cleanLatex = part.content;
                        let isDisplay = false;
                        
                        if (cleanLatex.startsWith('$$')) { cleanLatex = cleanLatex.slice(2, -2); isDisplay = true; }
                        else if (cleanLatex.startsWith('\\[')) { cleanLatex = cleanLatex.slice(2, -2); isDisplay = true; }
                        else if (cleanLatex.startsWith('\\(')) { cleanLatex = cleanLatex.slice(2, -2); isDisplay = false; }
                        else if (cleanLatex.startsWith('$')) { cleanLatex = cleanLatex.slice(1, -1); isDisplay = false; }
                        
                        cleanLatex = cleanLatex.trim();
                        if (!cleanLatex) continue;
 
                        try {
                            const mml = await MathJax.tex2mmlPromise(cleanLatex, {display: isDisplay});
                            htmlBuffer += mml;
                        } catch (e) {
                            htmlBuffer += part.content;
                        }
                    }
                }
                
                helper.innerHTML = htmlBuffer; 
                const range = document.createRange();
                range.selectNodeContents(helper);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                document.execCommand('copy');
                selection.removeAllRanges();
                
                status.innerText = "âœ… å¤åˆ¶æˆåŠŸï¼";
                status.style.color = "green";
                setTimeout(() => { status.innerText = "è‡ªåŠ¨å°±ç»ª"; status.style.color = "#666"; }, 2000);
 
            } catch (err) {
                console.error(err);
                status.innerText = "âŒ å¤åˆ¶å‡ºé”™";
                status.style.color = "red";
            }
        }
 
        function splitUniversal(text) {
            const regex = /(\$\$[\s\S]*?\$\$|\\\[[\s\S]*?\\\]|\\\([\s\S]*?\\\)|(?<!\\)\$[^$\n]+?\$)/g;
            const result = [];
            let lastIndex = 0;
            let match;
            while ((match = regex.exec(text)) !== null) {
                if (match.index > lastIndex) {
                    result.push({ type: 'text', content: text.slice(lastIndex, match.index) });
                }
                result.push({ type: 'latex', content: match[0] });
                lastIndex = regex.lastIndex;
            }
            if (lastIndex < text.length) {
                result.push({ type: 'text', content: text.slice(lastIndex) });
            }
            return result;
        }
    </script>
</body>
</html>